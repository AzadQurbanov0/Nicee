<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel - Gizli</title>
<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,'Helvetica Neue',Arial;
  background:#1e1e2f;
  color:#f8fafc;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}
h1{margin-bottom:20px;}
table{border-collapse:collapse;width:90%;max-width:700px;margin-top:10px;}
th,td{padding:10px;border:1px solid rgba(255,255,255,0.2);text-align:center;}
th{background:rgba(255,255,255,0.1);}
input[type=number]{width:50px;padding:2px;border-radius:4px;border:none;text-align:center;}
button.adjust{
  padding:4px 8px;
  border:none;
  border-radius:4px;
  cursor:pointer;
  font-weight:600;
  margin:2px;
}
button.add{background:#22c55e;color:#fff;}
button.sub{background:#f87171;color:#fff;}
button.apply{background:#3b82f6;color:#fff;}
</style>
</head>
<body>

<h1>Admin Panel - Gizli</h1>
<table id="userTable">
  <thead>
    <tr>
      <th>Ad</th>
      <th>Email</th>
      <th>Balans (AZN)</th>
      <th>Əməliyyat</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC4sGTK_P4KperVswrxxmt69H5cocsgnNw",
  authDomain: "niceuc-e5986.firebaseapp.com",
  databaseURL: "https://niceuc-e5986-default-rtdb.firebaseio.com",
  projectId: "niceuc-e5986",
  storageBucket: "niceuc-e5986.firebasestorage.app",
  messagingSenderId: "242221260650",
  appId: "1:242221260650:web:d140153a2167c4738dcf13",
  measurementId: "G-YKKRHJKYNB"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const userTable = document.getElementById('userTable').querySelector('tbody');

function loadUsers(){
  const usersRef = db.ref('users');
  usersRef.on('value', snapshot => {
    userTable.innerHTML = '';
    snapshot.forEach(child => {
      const uid = child.key;
      const data = child.val();
      const balanceRef = db.ref('balances/' + uid);

      balanceRef.get().then(bsnap => {
        const balance = bsnap.val() || 0;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${data.name}</td>
          <td>${data.email}</td>
          <td id="bal-${uid}">${parseFloat(balance).toFixed(2)}</td>
          <td>
            <button class="adjust add" onclick="adjustBalance('${uid}',1)">+1</button>
            <button class="adjust sub" onclick="adjustBalance('${uid}',-1)">-1</button><br>
            <input type="number" id="input-${uid}" value="0">
            <button class="adjust apply" onclick="changeBalance('${uid}')">Tətbiq et</button>
          </td>
        `;
        userTable.appendChild(tr);
      });
    });
  });
}

function adjustBalance(uid, amount){
  const balanceRef = db.ref('balances/' + uid);
  balanceRef.transaction(current => (current || 0) + amount);
}

function changeBalance(uid){
  const input = document.getElementById('input-' + uid);
  const val = parseFloat(input.value);
  if(isNaN(val)) return;
  const balanceRef = db.ref('balances/' + uid);
  balanceRef.transaction(current => (current || 0) + val);
  input.value = 0;
}

loadUsers();
</script>
</body>
</html>
