<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Paneli — Çeklər</title>
<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
  background:#0f172a;
  color:#e2e8f0;
}
.header{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px 20px;border-bottom:1px solid #334155;background:#0b1220;
}
.grid{
  padding:16px;
  display:grid;
  gap:16px;
  grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
}
.card{
  background:#111827;border:1px solid #1f2937;border-radius:12px;overflow:hidden;
}
.thumb{
  width:100%;height:160px;object-fit:cover;background:#0b1220;
}
.meta{
  padding:10px 12px;font-size:14px;line-height:1.4;
}
.meta .small{opacity:.8;font-size:12px;}
.meta a{color:#93c5fd;text-decoration:none;word-break:break-all;}
.meta a:hover{text-decoration:underline;}
</style>
</head>
<body>
  <div class="header">
    <h1>Çeklər</h1>
    <div class="small">Realtime Database → <code>receipts/</code></div>
  </div>

  <div id="list" class="grid"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>

  <script>
  const firebaseConfig = {
    apiKey: "AIzaSyC4sGTK_P4KperVswrxxmt69H5cocsgnNw",
    authDomain: "niceuc-e5986.firebaseapp.com",
    databaseURL: "https://niceuc-e5986-default-rtdb.firebaseio.com",
    projectId: "niceuc-e5986",
    storageBucket: "niceuc-e5986.firebasestorage.app",
    messagingSenderId: "242221260650",
    appId: "1:242221260650:web:d140153a2167c4738dcf13",
    measurementId: "G-YKKRHJKYNB"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // receipts/ altında push edilən hər qeydi kart kimi göstər
  const list = document.getElementById('list');

  // Sıralama üçün son 200 çək (istəsən artırmaq olar)
  const ref = db.ref('receipts').limitToLast(200);
  ref.on('child_added', snap => render(snap.key, snap.val()));
  ref.on('child_changed', snap => update(snap.key, snap.val()));
  ref.on('child_removed', snap => removeCard(snap.key));

  function tsFormat(ms){
    if(!ms) return '';
    const d = new Date(ms);
    return d.toLocaleString();
  }

  function cardTemplate(key, data){
    const {url, name='', email='', createdAt=null} = data || {};
    return `
      <div class="card" id="card-${key}">
        <a href="${url}" target="_blank" rel="noopener">
          <img class="thumb" src="${url}" alt="çek">
        </a>
        <div class="meta">
          <div><strong>${name || 'İstifadəçi'}</strong></div>
          <div class="small">${email || ''}</div>
          <div class="small">${tsFormat(createdAt)}</div>
          <div class="small"><a href="${url}" target="_blank" rel="noopener">Şəkli aç</a></div>
        </div>
      </div>
    `;
  }

  function render(key, data){
    const wrapper = document.createElement('div');
    wrapper.innerHTML = cardTemplate(key, data).trim();
    const el = wrapper.firstElementChild;
    list.prepend(el); // ən son gələn üstdə
  }

  function update(key, data){
    const el = document.getElementById('card-' + key);
    if(el){
      el.outerHTML = cardTemplate(key, data);
    }
  }

  function removeCard(key){
    const el = document.getElementById('card-' + key);
    if(el) el.remove();
  }
  </script>
</body>
</html>
