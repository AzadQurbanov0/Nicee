<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I N C I | Mağaza</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main: #2563eb; --bg: #f8fafc; --green: #10b981; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); padding-bottom: 80px; }
        header { background: white; padding: 18px; text-align: center; font-weight: bold; color: var(--main); font-size: 22px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .container { padding: 15px; max-width: 500px; margin: auto; }
        
        /* MƏHSUL VƏ ETİKET (Badge) */
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: white; border-radius: 15px; overflow: hidden; position: relative; border: 1px solid #eee; }
        .card img { width: 100%; height: 150px; object-fit: cover; }
        .badge-tag { position: absolute; top: 10px; left: 10px; background: #ef4444; color: white; padding: 4px 10px; border-radius: 8px; font-size: 10px; font-weight: bold; z-index: 5; }
        .badge-new { background: #10b981; }
        
        /* İZLƏMƏ ANİMASİYASI */
        .track-card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .track-item { display: flex; align-items: flex-start; margin-bottom: 25px; position: relative; }
        .track-item::after { content: ''; position: absolute; left: 12px; top: 30px; width: 2px; height: 30px; background: #e2e8f0; }
        .track-item:last-child::after { display: none; }
        
        .track-dot { width: 26px; height: 26px; border-radius: 50%; background: #e2e8f0; display: flex; align-items: center; justify-content: center; z-index: 2; transition: 0.5s; }
        .track-item.active .track-dot { background: var(--green); box-shadow: 0 0 15px var(--green); transform: scale(1.2); }
        .track-item.active .track-dot i { color: white; font-size: 12px; }
        
        .track-info { margin-left: 15px; flex: 1; }
        .track-info b { font-size: 15px; display: block; color: #64748b; transition: 0.3s; }
        .track-item.active .track-info b { color: #1e293b; }
        .track-time { font-size: 11px; color: var(--green); font-weight: 600; }

        .nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; padding: 12px 0; border-top: 1px solid #eee; }
        .nav-item { flex: 1; text-align: center; color: #94a3b8; font-size: 11px; cursor: pointer; }
        .nav-item.active { color: var(--main); }
        .add-btn { background: var(--main); color: white; border: none; padding: 10px; border-radius: 8px; width: 100%; cursor: pointer; margin-top: 5px; }
        
        section { display: none; }
        .active-section { display: block; }
    </style>
</head>
<body>

<header>I N C I</header>

<div class="container">
    <section id="shop" class="active-section">
        <div id="productList" class="product-grid"></div>
    </section>

    <section id="track">
        <h3 style="text-align:center;">Sifarişin Durumu</h3>
        <div id="trackView"></div>
    </section>
</div>

<div class="nav">
    <div class="nav-item active" onclick="showPage('shop', this)"><i class="fa-solid fa-house"></i><div>Mağaza</div></div>
    <div class="nav-item" onclick="showPage('track', this)"><i class="fa-solid fa-truck-fast"></i><div>İzləmə</div></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBykQbnz828fnJSYpaWZb9lVMt76y5uYp8",
        authDomain: "azad042-65afa.firebaseapp.com",
        databaseURL: "https://azad042-65afa-default-rtdb.firebaseio.com",
        projectId: "azad042-65afa",
        storageBucket: "azad042-65afa.firebasestorage.app",
        messagingSenderId: "568634268703",
        appId: "1:568634268703:web:3c3dd14a071b0ffe73492a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Məhsulları Render et (Etiketlərlə)
    db.ref('products').on('value', snap => {
        let html = "";
        snap.forEach(child => {
            let p = child.val();
            let tagHtml = p.tag ? `<div class="badge-tag ${p.tag=='Yeni'?'badge-new':''}">${p.tag}</div>` : '';
            html += `<div class="card">
                ${tagHtml}
                <img src="${p.img}">
                <div style="padding:10px;">
                    <b>${p.name}</b>
                    <div style="color:var(--main); font-weight:bold; margin:5px 0;">${p.price} AZN</div>
                    <button class="add-btn">Səbətə at</button>
                </div>
            </div>`;
        });
        document.getElementById("productList").innerHTML = html;
    });

    function renderTrack() {
        const lid = localStorage.getItem("lastId") || "200983"; // Test üçün son ID
        db.ref('orders').on('value', snap => {
            let o = Object.values(snap.val() || {}).find(x => x.id == lid);
            if(!o) return;

            const steps = [
                { s: "Sifariş verildi", i: "fa-check", t: o.time_Sifariş_verildi },
                { s: "Hazırlanır", i: "fa-utensils", t: o.time_Hazırlanır },
                { s: "Paketləmə", i: "fa-box", t: o.time_Paketləmə },
                { s: "Yola düşüb", i: "fa-motorcycle", t: o.time_Yola_düşüb },
                { s: "Təhvil verildi", i: "fa-house-chimney", t: o.time_Təhvil_verildi }
            ];

            let currentIdx = steps.findIndex(x => x.s === o.status);
            
            document.getElementById("trackView").innerHTML = `
                <div class="track-card">
                    <p style="margin-top:0;">Kod: <b>#${o.id}</b></p>
                    ${steps.map((step, idx) => `
                        <div class="track-item ${idx <= currentIdx ? 'active' : ''}">
                            <div class="track-dot"><i class="fas ${step.i}"></i></div>
                            <div class="track-info">
                                <b>${step.s}</b>
                                ${step.t ? `<span class="track-time"><i class="fa-regular fa-clock"></i> ${step.t}</span>` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>`;
        });
    }

    function showPage(id, el) {
        document.querySelectorAll('section').forEach(s => s.classList.remove('active-section'));
        document.getElementById(id).classList.add('active-section');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        if(id === 'track') renderTrack();
    }
</script>
</body>
</html>
