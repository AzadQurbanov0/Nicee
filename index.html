<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Panel - Balans İdarəsi</title>
<style>
:root{
  --bg:#1e1e2f;
  --card:#2e2e4a;
  --text:#f8fafc;
  --accent:#22c55e;
  --danger:#f87171;
}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,'Helvetica Neue',Arial;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}
h1{margin-bottom:20px;}
#loginBtn{
  padding:10px 18px;
  font-size:1rem;
  background:#4285F4;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:8px;
  font-weight:600;
}
#loginBtn img{width:20px;height:20px;}
#userInfo{margin-bottom:16px;font-weight:600;}
table{border-collapse:collapse;width:90%;max-width:700px;margin-top:10px;}
th,td{padding:10px;border:1px solid rgba(255,255,255,0.2);text-align:center;}
th{background:rgba(255,255,255,0.1);}
button.adjust{
  padding:4px 8px;
  border:none;
  border-radius:4px;
  cursor:pointer;
  font-weight:600;
}
button.add{background:var(--accent);color:#fff;}
button.sub{background:var(--danger);color:#fff;}
</style>
</head>
<body>

<h1>Admin Panel - Balans İdarəsi</h1>
<div id="userInfo"></div>
<button id="loginBtn"><img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="G"> Google ilə Giriş</button>

<table id="userTable" style="display:none">
  <thead>
    <tr>
      <th>Ad</th>
      <th>Email</th>
      <th>Balans (AZN)</th>
      <th>Əməliyyat</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC4sGTK_P4KperVswrxxmt69H5cocsgnNw",
  authDomain: "niceuc-e5986.firebaseapp.com",
  databaseURL: "https://niceuc-e5986-default-rtdb.firebaseio.com",
  projectId: "niceuc-e5986",
  storageBucket: "niceuc-e5986.firebasestorage.app",
  messagingSenderId: "242221260650",
  appId: "1:242221260650:web:d140153a2167c4738dcf13",
  measurementId: "G-YKKRHJKYNB"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

const loginBtn = document.getElementById('loginBtn');
const userInfoDiv = document.getElementById('userInfo');
const userTable = document.getElementById('userTable').querySelector('tbody');

loginBtn.addEventListener('click', () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
    .then(res => checkAdmin(res.user))
    .catch(err => alert(err.message));
});

// Admin yoxlama
function checkAdmin(user){
  const adminRef = db.ref('admins/' + user.uid);
  adminRef.get().then(snapshot => {
    if(snapshot.exists()){
      userInfoDiv.textContent = `Salam, ${user.displayName} (${user.email}) - Admin Giriş etdi`;
      loginBtn.style.display='none';
      loadUsers();
    } else {
      alert("Siz admin deyilsiniz!");
      auth.signOut();
    }
  });
}

// İstifadəçiləri yüklə
function loadUsers(){
  const usersRef = db.ref('users');
  usersRef.on('value', snapshot => {
    userTable.innerHTML = '';
    snapshot.forEach(child => {
      const uid = child.key;
      const data = child.val();
      const balanceRef = db.ref('balances/' + uid);

      // Balansı oxu
      balanceRef.get().then(bsnap => {
        const balance = bsnap.val() || 0;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${data.name}</td>
          <td>${data.email}</td>
          <td id="bal-${uid}">${parseFloat(balance).toFixed(2)}</td>
          <td>
            <button class="adjust add" onclick="adjustBalance('${uid}',1)">+</button>
            <button class="adjust sub" onclick="adjustBalance('${uid}',-1)">-</button>
          </td>
        `;
        userTable.appendChild(tr);
      });
    });
    document.getElementById('userTable').style.display='table';
  });
}

// Balansı dəyiş
function adjustBalance(uid, amount){
  const balanceRef = db.ref('balances/' + uid);
  balanceRef.transaction(current => {
    return (current || 0) + amount;
  });
  // UI avtomatik yenilənəcək onValue listener ilə
}
</script>
</body>
</html>
